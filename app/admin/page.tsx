"use client";
import { useState } from "react";
import useSWR from "swr";
const fetcher = (u:string)=>fetch(u).then(r=>r.json());
export default function AdminPage(){
  const { data, mutate } = useSWR("/api/recipes", fetcher);
  const [form, setForm] = useState({ id:"", name:"", desc:"", price:"", emoji:"", imageUrl:"", videoUrl:"", tags:"", available:true });
  const up = async (e: any, field: "imageUrl"|"videoUrl") => {
    const file = e.target.files?.[0]; if(!file) return;
    const fd = new FormData(); fd.append("file", file);
    const res = await fetch("/api/upload", { method:"POST", body: fd }); const j = await res.json();
    if(j.url) setForm(f=>({...f, [field]: j.url}));
  };
  const save = async () => { await fetch("/api/recipes",{method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify(form)}); setForm({ id:"", name:"", desc:"", price:"", emoji:"", imageUrl:"", videoUrl:"", tags:"", available:true }); mutate(); };
  const del = async (id:string)=>{ await fetch(`/api/recipes?id=${id}`,{method:"DELETE"}); mutate(); };
  return (<div className="min-h-screen bg-black text-white"><header className="sticky top-0 z-10 border-b border-red-900/40 bg-black/70 backdrop-blur"><div className="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between"><h1 className="text-2xl font-bold">Rest1 ‚Äî Admin</h1><a href="/" className="text-sm text-white/70 hover:text-white">‚Üê Back</a></div></header><main className="mx-auto max-w-6xl px-4 py-8 grid md:grid-cols-2 gap-8"><section className="border border-red-900/40 rounded-2xl p-6 bg-zinc-950"><h2 className="text-xl font-semibold">Add / Edit Item</h2><div className="grid gap-3 mt-4"><input value={form.name} onChange={e=>setForm({...form,name:e.target.value})} placeholder="Name" className="rounded-xl bg-black border border-white/10 px-4 py-2"/><input value={form.desc} onChange={e=>setForm({...form,desc:e.target.value})} placeholder="Description" className="rounded-xl bg-black border border-white/10 px-4 py-2"/><input value={form.price} onChange={e=>setForm({...form,price:e.target.value})} placeholder="Price (‚Çπ349)" className="rounded-xl bg-black border border-white/10 px-4 py-2"/><input value={form.emoji} onChange={e=>setForm({...form,emoji:e.target.value})} placeholder="Emoji (üçó)" className="rounded-xl bg-black border border-white/10 px-4 py-2"/><div className="grid gap-2"><label className="text-sm text-white/70">Image</label><div className="flex items-center gap-2"><input type="file" accept="image/*" onChange={(e)=>up(e,"imageUrl")} />{form.imageUrl && <a href={form.imageUrl} target="_blank" className="text-xs text-red-400 underline">Preview</a>}</div></div><div className="grid gap-2"><label className="text-sm text-white/70">Video</label><div className="flex items-center gap-2"><input type="file" accept="video/*" onChange={(e)=>up(e,"videoUrl")} />{form.videoUrl && <a href={form.videoUrl} target="_blank" className="text-xs text-red-400 underline">Preview</a>}</div></div><input value={form.tags} onChange={e=>setForm({...form,tags:e.target.value})} placeholder="Tags (comma separated)" className="rounded-xl bg-black border border-white/10 px-4 py-2"/><label className="flex items-center gap-2 text-sm text-white/80"><input type="checkbox" checked={form.available} onChange={e=>setForm({...form,available:e.target.checked})} className="accent-red-600"/> Available</label><button onClick={save} className="mt-2 rounded-xl bg-red-600 hover:bg-red-500 px-4 py-2 font-semibold">Save</button></div></section><section className="border border-red-900/40 rounded-2xl p-6 bg-zinc-950"><h2 className="text-xl font-semibold">Items</h2><div className="mt-4 space-y-3">{data?.items?.map((r:any)=>(<div key={r.id} className="rounded-xl border border-white/10 p-4 flex items-start justify-between gap-4"><div className="min-w-0"><div className="font-semibold truncate">{r.emoji || "üçΩÔ∏è"} {r.name} {r.available?"":"(hidden)"}</div>{r.desc && <div className="text-sm text-white/70 truncate">{r.desc}</div>}<div className="text-xs text-white/50 mt-1 flex flex-wrap gap-2">{r.price && <span className="rounded border border-white/10 px-2 py-0.5">{r.price}</span>}{r.tags?.map((t:string,i:number)=>(<span key={i} className="rounded border border-white/10 px-2 py-0.5">{t}</span>))}</div>{r.imageUrl && <div className="text-xs mt-2"><a className="underline text-white/70" href={r.imageUrl} target="_blank">Image</a></div>}{r.videoUrl && <div className="text-xs"><a className="underline text-white/70" href={r.videoUrl} target="_blank">Video</a></div>}</div><button onClick={()=>del(r.id)} className="rounded-lg border border-red-800 px-3 py-1 text-sm hover:bg-red-800/20">Delete</button></div>))}</div></section></main></div>);
}
